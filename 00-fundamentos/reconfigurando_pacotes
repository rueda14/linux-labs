## Reconfigurando pacotes ##

============================================================================
Reconfigurar pacotes no Debian/Ubuntu - dpkg-reconfigure
============================================================================

O QUE É
-------
dpkg-reconfigure é uma ferramenta da família dpkg (Debian/Ubuntu e derivados)
que permite REEXECUTAR o processo de configuração de um pacote já instalado.

Na prática, ele "abre novamente" as telas de configuração (debconf) e reaplica
scripts de configuração do pacote, sem precisar remover e instalar de novo.

IMPORTANTE (nome correto)
-------------------------
O comando normalmente é:
  dpkg-reconfigure <pacote>

Muita gente fala "dpkg -reconfigure", mas o utilitário padrão é "dpkg-reconfigure".
O dpkg (binário principal) não tem a opção "-reconfigure" como flag comum.
Se no seu sistema funcionar algo diferente, é alias/script, mas o padrão é:
  /usr/sbin/dpkg-reconfigure

PARA QUE SERVE (CASOS REAIS)
-----------------------------
1) Refazer perguntas de configuração:
   - teclado (layout)
   - timezone
   - locales (idioma/acentos)
   - rede (dependendo do pacote)
   - serviços como postfix, tzdata, openssh-server (alguns mostram perguntas)

2) Corrigir configuração quebrada após mudanças:
   - arquivos de configuração inconsistentes
   - parâmetros de debconf bagunçados
   - pacotes que ficaram "meio configurados"

3) Reaplicar scripts de post-install do pacote:
   - pode regenerar arquivos
   - pode reiniciar serviços (dependendo do pacote e das regras do systemd)

OBS:
- Ele não é um “wizard universal”: só funciona bem em pacotes que usam debconf
  e que têm passos de configuração planejados para isso.

COMO FUNCIONA POR BAIXO
-----------------------
- Usa o sistema de perguntas/respostas do Debian chamado "debconf".
- Recupera respostas armazenadas (banco debconf) e permite refazer perguntas.
- Roda os scripts do pacote para aplicar as escolhas (config, postinst etc.).
- Pode disparar ações como regenerar arquivos e recarregar serviços.

REQUISITOS E BOAS PRÁTICAS
--------------------------
- Geralmente você precisa de root:
    sudo dpkg-reconfigure <pacote>

- Se estiver automatizando, prefira modo não interativo (quando possível)
  e/ou preseeding (debconf-set-selections).

USO BÁSICO
----------
1) Reconfigurar um pacote (modo interativo):
    sudo dpkg-reconfigure <nome-do-pacote>

Exemplos práticos comuns:
    sudo dpkg-reconfigure tzdata
    sudo dpkg-reconfigure locales
    sudo dpkg-reconfigure keyboard-configuration

2) Ver o que o pacote chama no apt/dpkg:
   - O nome do pacote é o nome no APT, não o nome do comando.
   Para descobrir:
    dpkg -l | grep <termo>
    apt-cache search <termo>

OPÇÕES PRINCIPAIS (as mais úteis no dia a dia)
----------------------------------------------
As opções podem variar um pouco por versão, mas estas são as mais comuns:

1) Escolher o "frontend" (tipo de interface de perguntas):
    sudo dpkg-reconfigure -f dialog <pacote>
    sudo dpkg-reconfigure -f readline <pacote>
    sudo dpkg-reconfigure -f noninteractive <pacote>

Frontends típicos:
- dialog        → telas em modo texto (mais comum)
- readline      → perguntas linha a linha no terminal
- teletype      → semelhante ao readline (dependendo do sistema)
- noninteractive→ não pergunta nada (útil em automação, mas pode não surtir efeito
                  se o pacote exigir respostas novas)

2) Forçar prioridade das perguntas (mostrar mais ou menos perguntas):
    sudo dpkg-reconfigure -p low <pacote>
    sudo dpkg-reconfigure -p medium <pacote>
    sudo dpkg-reconfigure -p high <pacote>
    sudo dpkg-reconfigure -p critical <pacote>

Como interpretar:
- low      → mostra TUDO (até perguntas “avançadas”)
- medium   → padrão comum
- high     → mostra só o que é bem relevante
- critical → só perguntas críticas (quase nada)

Na prática, quando você quer "ver todas as opções":
    sudo dpkg-reconfigure -p low <pacote>

3) Ajuda:
    dpkg-reconfigure --help

COMBINAÇÕES ÚTEIS
-----------------
1) Quero refazer tudo e ver todas as perguntas:
    sudo dpkg-reconfigure -p low <pacote>

2) Quero refazer em modo bem simples (linha a linha):
    sudo dpkg-reconfigure -f readline <pacote>

3) Quero rodar em automação (sem prompts) — com cuidado:
    sudo dpkg-reconfigure -f noninteractive <pacote>

ATENÇÃO:
- Em modo noninteractive, se o pacote precisa de escolhas novas, ele pode:
  - manter padrão atual
  - falhar
  - ou não aplicar o que você espera
Para automação séria, o correto é "preseed" (debconf-set-selections) antes.

COMO SABER SE UM PACOTE “VALE A PENA” RECONFIGURAR
---------------------------------------------------
Nem todo pacote tem interface debconf.
Alguns quase não perguntam nada e apenas usam arquivos em /etc.

Sinais de que dpkg-reconfigure pode ajudar:
- Você lembra que durante a instalação apareceu um “assistente”
- O pacote é conhecido por usar debconf (tzdata, locales, postfix etc.)
- Você precisa reexecutar esse “assistente” sem reinstalar

Se o pacote não usa debconf:
- Melhor editar /etc/<arquivo>.conf e reiniciar serviço
- Ou usar a ferramenta oficial do pacote

IMPACTOS E CUIDADOS (MUITO IMPORTANTE)
--------------------------------------
1) Pode alterar arquivos em /etc
- Normalmente respeita arquivos existentes, mas pode reescrever/regenerar
  alguns dependendo do pacote.

2) Pode reiniciar ou recarregar serviços
- Ex.: reconfigurar postfix ou openssh-server pode afetar serviços em execução.

3) Pode mudar comportamento do sistema
- Timezone/locales/teclado afetam sessões, logs, ordenação e codificação.

4) Ambiente remoto (SSH)
- Se reconfigurar rede/ssh, cuidado para não se desconectar.

EXEMPLOS PRÁTICOS (MODELO DE USO)
---------------------------------
1) Ajustar timezone:
    sudo dpkg-reconfigure tzdata

2) Ajustar locales (idioma/UTF-8):
    sudo dpkg-reconfigure locales

3) Ajustar teclado (layout ABNT2, por exemplo):
    sudo dpkg-reconfigure keyboard-configuration

4) Reconfigurar mostrando todas as opções:
    sudo dpkg-reconfigure -p low tzdata

DIFERENÇA PARA OUTROS COMANDOS RELACIONADOS
-------------------------------------------
- dpkg --configure -a
  → tenta configurar pacotes que ficaram "desconfigurados" por erro/interrupção.
  É recuperação de falhas, não “refazer perguntas”.

- apt-get -f install
  → corrige dependências quebradas para completar instalações.

- editar /etc/<arquivo>.conf
  → reconfig manual, às vezes necessário quando não há debconf.

CHECKLIST RÁPIDO DE TROUBLESHOOTING
-----------------------------------
Se você está tentando corrigir algo e não sabe o caminho:

1) O pacote está instalado?
    dpkg -l | grep <pacote>

2) Tem pacotes quebrados?
    sudo dpkg --configure -a
    sudo apt-get -f install

3) Reconfigure para refazer perguntas:
    sudo dpkg-reconfigure <pacote>

4) Se quiser ver tudo:
    sudo dpkg-reconfigure -p low <pacote>

5) Se for automação:
   - avaliar preseeding (debconf-set-selections) antes
   - usar -f noninteractive com cautela

RESUMO FINAL
------------
dpkg-reconfigure é o comando padrão para "reexecutar a configuração" de um pacote
já instalado, especialmente quando ele usa debconf (telas de configuração).
Ele é ótimo para ajustes de sistema (timezone, locales, teclado) e para refazer
assistentes sem reinstalar o pacote.

Comandos-chave:
- sudo dpkg-reconfigure <pacote>
- sudo dpkg-reconfigure -p low <pacote>
- sudo dpkg-reconfigure -f readline <pacote>
- sudo dpkg-reconfigure -f noninteractive <pacote>
